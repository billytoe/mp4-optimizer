# Changelog

本文件记录了项目的所有重要变更。
格式基于 [Keep a Changelog](https://keepachangelog.com/zh-CN/1.0.0/)，
并且本项目遵循 [Semantic Versioning](https://semver.org/spec/v2.0.0.html)。

## [Unreleased]



## [0.0.5] - 2026-02-19

### 🐛 修复 (Fixed)
- **Windows 优化失败**: 修复了 Windows 平台下优化 MP4 文件报错的问题。
  - 原因：优化完成后执行文件替换时，原文件的读取句柄尚未关闭，Windows 文件锁定机制导致替换失败。
  - 修复：在替换文件前先关闭原文件句柄，确保 Windows 下文件操作正常。



## [0.0.4] - 2026-02-15

### ✨ 新增 (Added)
- **文件完整性检测**: 新增 MP4 文件完整性验证功能。
  - 检测文件是否被截断/不完整。
  - 不完整的文件会在列表中显示红色"文件不完整"警告标志。
  - 避免处理损坏的文件导致意外错误。
- **优化进度显示**: 新增转换进度实时显示功能。
  - 显示当前正在转换的文件。
  - 显示转换进度百分比和状态消息。
- **串行转换**: 改为逐个文件转换，节省磁盘空间。
- **临时文件管理**: 
  - 优化过程中使用临时文件，成功后原子替换原文件，确保原文件安全。
  - 软件启动、打开文件夹、强制关闭时自动清理残留临时文件。
  - 仅清理本软件生成的临时文件（格式：`{文件名}_tmp_{随机数}.mp4`），不会误删其他软件文件。

### 🐛 修复 (Fixed)
- **关闭确认**: 修复正在优化时无法关闭软件的问题。
  - 正在优化时点击关闭按钮会弹出确认对话框。
  - 选择"继续优化"保持程序运行。
  - 选择"强制关闭"清理临时文件后退出。
- **按钮状态**: 优化过程中禁用清空、添加文件、添加文件夹等按钮，防止误操作。
- **临时文件过滤**: 临时文件不会出现在文件列表中。

### ⚡ 优化 (Changed)
- **转换流程**: 优化转换流程为读取原文件→写入临时文件→成功后覆盖源文件，避免软件强制中止破坏原文件。



## [0.0.3] - 2026-02-10

### 🐛 修复 (Fixed)
- **修复 windows 10 无法拖拽文件的问题**

## [0.0.2] - 2026-02-07

### ✨ 新增 (Added)
- **Build System**: 构建脚本 (`scripts/build_release.sh`) 现支持同时生成 Release 和 Debug 双版本。
  - Release 版 (`FastStartInspector_vX.X.X.exe`): 无控制台窗口，适合最终用户。
  - Debug 版 (`FastStartInspector_Debug_vX.X.X.exe`): 保留控制台窗口，便于查看运行日志。
- **UI**: 界面拖拽区域提示文本更新，明确支持 "MP4 文件或文件夹"。
- **DevOps**: 新增 AI Skills 自动安装脚本 (`scripts/install_skills.sh`)。

### 🐛 修复 (Fixed)
- **Windows 拖拽 (Drag & Drop)**: 
  - 彻底修复了 Windows 平台下文件夹拖拽失效的问题。
  - 采用了原生 `drop` 事件处理机制，绕过了 WebView2 对文件夹拖拽的限制。
  - 增强了文件过滤逻辑，防止有效文件夹被误判。
- **元数据解析 (Metadata)**: 
  - 修复了部分未优化的 MP4 文件（`moov` 原子位于文件末尾，例如 OBS 录制文件）无法读取分辨率和编码信息的问题。
  - 重构了 `GetMetadata` 逻辑，引入健壮的 `pkg/atomic` 库进行原子定位。
- **版本号规范**: 修复了构建脚本中版本号处理不一致的问题。现在统一遵循 SemVer 规范（内部版本号纯数字，文件名带 `v` 前缀）。



### 🐛 修复 (Fixed)
- **macOS 自动更新**: 修复了严重 Bug，之前的更新逻辑会将 `.zip` 文件直接覆盖可执行文件导致应用损坏。现在正确实现了：
  - 下载 `.zip` 到临时文件
  - 解压 `.zip` 到临时目录
  - 定位并替换整个 `.app` Bundle
  - 替换失败时自动回滚到旧版本

### ⚡ 优化 (Changed)
- **Core**: 验证并确保了 MP4 优化逻辑的安全性。采用原位替换 (`Replace`) + `.bak` 备份机制，若优化失败会自动恢复原文件。

## [0.0.1] - 2026-02-01

### 🎉 初始发布 (Initial Release)
- 基础功能：MP4 FastStart 结构检测与优化。
- 支持单个文件和批量文件拖拽。
- 跨平台支持 (Windows / macOS)。
- 简单的状态列表与进度显示。
